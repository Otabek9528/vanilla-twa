<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Today's Prayer Times</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>

  <!-- HEADER -->
  <header class="app__header">
    <div class="header-content">
      <img src="../assets/emblem.jpg" alt="Bot Emblem" class="bot-logo" />
      <h1>Muslim Vegukin Bot</h1>
    </div>
  </header>

  <!-- PRAYER DETAILS -->
  <section class="prayers-detailed">

    <h2 id="cityName">Loading...</h2>
    <p id="coords" class="coords-label">Coordinates: -- , --</p>
    <p id="todayDate">Fetching date...</p>

    <!-- Countdown -->
    <div class="next-prayer-countdown">
      <p>Next prayer: <span id="nextPrayerName">Loading...</span></p>
      <p class="countdown-text">⏳ <span id="countdown">--:--:--</span></p>
    </div>

    <!-- Prayer list -->
    <div class="prayer-list" id="prayerList"></div>

  </section>  

  <!-- BACK BUTTON -->
  <footer class="back-footer">
    <button class="back-btn" id="backToMain">⬅ Back to Main</button>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Load geolocation FIRST -->
  <script src="../js/geolocation.js"></script>

  <!-- Prayer calculation logic -->
  <script src="../js/prayerTimes.js"></script>

  <!-- Page-specific logic for rendering -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const tg = window.Telegram.WebApp;
      tg.BackButton.hide();

      // BACK button to Home
      document.getElementById("backToMain").addEventListener("click", () => {
        window.location.href = "../index.html";
      });

      // Initialize location using geolocation.js
      initLocation(async (lat, lon, city) => {

        // Update city + coordinates
        document.getElementById("cityName").innerText = city;
        document.getElementById("coords").innerText =
          `Coordinates: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;

        // Load prayer data
        const data = await getPrayerTimes(lat, lon);
        const timings = data.timings;

        // Display today (Gregorian + Hijri)
        document.getElementById("todayDate").innerText =
          `${data.date.gregorian.date} • ${data.date.hijri.date}`;

        // Determine current + next prayer
        const { current, next } = getCurrentPrayer(timings);

        document.getElementById("nextPrayerName").innerText = next;

        updateCountdown(next, timings);
        setInterval(() => updateCountdown(next, timings), 1000);

        // Build prayer list dynamically
        const prayerOrder = [
          "Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"
        ];

        const listBox = document.getElementById("prayerList");
        listBox.innerHTML = ""; // clear old

        prayerOrder.forEach(p => {
          const row = document.createElement("div");
          row.className = "prayer-row";

          row.innerHTML = `
            <div class="prayer-row-left">
              <span class="prayer-name">${p}</span>
            </div>
            <div class="prayer-row-right">
              <span class="prayer-time">${timings[p]}</span>
            </div>
          `;

          // highlight current prayer
          if (p === current) {
            row.classList.add("active-prayer");
          }

          listBox.appendChild(row);
        });

      });
    });
  </script>

</body>
</html>
